---
interface Props {
  address: string;
  lat?: number;
  lng?: number;
  zoom?: number;
  height?: string;
}

const { 
  address, 
  lat = 19.432608, 
  lng = -99.133209, 
  zoom = 15,
  height = "400px"
} = Astro.props;

// Codifica la dirección para su uso en la URL
const encodedAddress = encodeURIComponent(address);
---

<div class="mb-8">
  <div class="bg-gray-200 rounded-lg overflow-hidden" style={`height: ${height};`}>
    <!-- Contenedor del mapa -->
    <div id="map" class="w-full h-full"></div>
  </div>
  
  <div class="mt-4 flex items-start">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary mt-1 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
    </svg>
    <p class="text-gray-700">{address}</p>
  </div>
  
  <div class="mt-2">
    <a 
      href={`https://www.google.com/maps/search/?api=1&query=${encodedAddress}`} 
      target="_blank" 
      rel="noopener noreferrer"
      class="inline-flex items-center text-primary hover:text-primary-dark"
    >
      <span>Ver en Google Maps</span>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
      </svg>
    </a>
  </div>
</div>

<script define:vars={{ lat, lng, zoom }}>
// Esta es una implementación simplificada. En un entorno de producción,
// necesitarías una clave API de Google Maps.
document.addEventListener('DOMContentLoaded', function() {
  // Comprobar si el API de Google Maps está disponible
  if (typeof google === 'undefined' || typeof google.maps === 'undefined') {
    // Si no está disponible, mostrar un placeholder
    const mapEl = document.getElementById('map');
    if (mapEl) {
      mapEl.innerHTML = `
        <div class="w-full h-full flex flex-col items-center justify-center bg-gray-100 p-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
          </svg>
          <p class="text-gray-600 text-center">Mapa no disponible en este momento.<br>Por favor, utilice el enlace de Google Maps debajo.</p>
        </div>
      `;
    }
    return;
  }
  
  // Inicializar el mapa
  const mapOptions = {
    center: { lat, lng },
    zoom,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    mapTypeControl: false,
    streetViewControl: false,
    fullscreenControl: true,
  };
  
  const map = new google.maps.Map(document.getElementById('map'), mapOptions);
  
  // Añadir marcador
  new google.maps.Marker({
    position: { lat, lng },
    map,
    animation: google.maps.Animation.DROP
  });
});
</script> 